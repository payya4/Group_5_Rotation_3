Introduction
This project addresses the genomic analysis of A. lyrata species to understand the genetic diversity, structure, and evolutionary aspects. The analysis includes the identification of population structures, allele frequency estimation, and the investigation of hybrids. The expected outcomes are detailed PCA plots, population structure inferences, and allele frequency distributions across different populations.
Package Installation
Install specific versions of the packages used in this analysis:

Install the following R packages:
vcfR=1.15.0
ggplot2=3.4.4
ggrepel=0.9.5
adegenet=2.1.10
pegas=1.3
StAMPP=1.6.3
ade4=1.7.22
MASS=7.3.60
adegraphics=1.0.21
geosphere=1.5.18
dplyr=1.1.4
tidyverse=2.0.0
ape=5.7.1
ade4=1.7.22

Other Tools:
gatk4= 4.5.0.0 
gcc 14.0.0 (install using Homebrew)

Script Files:
est_cov_pca.r: An R script file for estimating the covariance matrix and performing PCA.
Easy_adegenet_script_and_modified_functions.R: An R script file for advanced PCA plotting and generating .dst files for further analysis in SplitsTree.
poly_freq.c: C source code for calculating allele frequencies from a VCF file.

Data

GATK:
Input File 1 (language:UNIX)
VCF File:

Output Data:
my_filtered_output.vcf - The VCF file after initial filtering to include specific populations.
script used:



PCA:
Input files 2 (tomas script for PCA)(language:R)

my_filtered_output.vcf -Same output VCF file for GATK processing (reused for outlier removal).

output file 2:
PCA plot saved as an object in the R environment (not explicitly saved to a file within the script).
The plot is displayed within the R session when the script runs.
To save the plot, you would need to add a ggsave() function or similar at the end of the script.

script used:
https://github.com/thamala/polySV/blob/main/est_cov_pca.r


Input files 3 (Adegenet-based PCA)(language:R)
my_filtered_output.vcf -Same output VCF file for GATK processing (reused for outlier removal).

output file 3:
PCA_all_SNPs_ax12_1K_less.pdf - PCA plots saved as PDF.
script used:
https://moodle.nottingham.ac.uk/pluginfile.php/10729623/mod_resource/content/1/Easy_adegenet_script_and_modified_functions.R Provided by Dr. Levi Yant

PCA INFO:
Both scripts seem to process the same VCF file, but they might be using different methods or focusing on different aspects of the data for PCA. The tomas script explicitly filters out SNPs with a minor allele frequency outside the 0.05-0.95 range, whereas the other script seems to focus on fast PCA calculations on genlight objects, which is suitable for large datasets typically encountered in genomics.


Input files 4: (language:R)
my_filtered_output.vcf": The filtered SNP dataset read using vcfR

Output files 4:
Graphical representations of PCAs and NJ trees.
A PDF file ("PCA_populations_location.pdf") with the PCA plots.
A PDF file ("Ana_v_PCA_all_ploidycol_SNPs_ax12_1K_less.pdf") with ploidy-differentiated PCA plots.
Distance matrices files for individuals ("aa.indiv_Neis_distance_4ds.phy.dst") and populations ("aa.pops_Neis_distance_4ds.phy.dst") in Phylip format.
A tree file ("NJ.tree_populations_4ds.tre") containing the NJ tree of populations.
A tree file ("NJ.distance_tree_outgroups.tre") for the NJ tree based on distance analysis.

script used:
adegenet_Ana_version.R Provided by Dr. Levi Yant


info: 
 It follows the same previous script by reading in a VCF file and then conducting a principal component analysis (PCA). However, it also includes additional components such as geographic distance calculations and Nei's genetic distance. It also provides for the creation of Neighbour Joining (NJ) trees and distance-based analyses. The .dst file can then be used for SplitsTree, to explore relationships and distances between your samples or populations in a way that might reveal more complex patterns than traditional phylogenetic trees.

Download splitstree: https://uni-tuebingen.de/en/fakultaeten/mathematisch-naturwissenschaftliche-fakultaet/fachbereiche/informatik/lehrstuehle/algorithms-in-bioinformatics/software/splitstree/




Remove the outliers (Repeat previous steps again):

GATK (to create a newer VCF file that only includes variants from the populations you are interested in (without the outliers this time):
(language:UNIX)
Input files 5:
Chrom_1_noSnakemake.lyrata.bipassed.dp.m.bt.1pct.ld_pruned.vcf: This file contains variant data that will be filtered by the command.


Output Files 5:
my_filtered_output_no_outliers.vcf: This new VCF file will exclude the specified samples and will contain only the variants from the desired populations without the outliers.

Script used:



PCA:

Input Files 6:(language:R)
my_filtered_output_no_outliers.vcf

Output files 6:
PCA Plot: The script does not explicitly save the PCA plot to a file, but it generates a plot within the R environment. This plot visualizes the principal components with samples colored by their ploidy levels.


script used:
https://github.com/thamala/polySV/blob/main/est_cov_pca.r


Input files 7: (language:R)
my_filtered_output_no_outliers.vcf 

Output files 7:
PCA Plot File: PCA_all_SNPs_ax12_1K_less.pdf

script used:
https://moodle.nottingham.ac.uk/pluginfile.php/10729623/mod_resource/content/1/Easy_adegenet_script_and_modified_functions.R


Input files 8:(language:R)
my_filtered_output_no_outliers.vcf

Output files 8:
PCA Plot (PCA_populations_location.pdf): This PDF file contains the PCA plots generated from the PCA analysis, visualizing the principal components and clustering of the populations.
Phylogenetic Tree File (NJ.tree_populations_4ds.tre): A tree file generated from a neighbor-joining (NJ) analysis, representing the phylogenetic relationships between the samples.
Nei's Distance Files:
Individual Distance Matrix (aa.indiv_Neis_distance_4ds.phy.dst): Contains Nei's genetic distance between individuals, formatted for use with tools like SplitsTree.
Population Distance Matrix (aa.pops_Neis_distance_4ds.phy.dst): Contains Nei's genetic distance between populations, also formatted for external analysis tools

extra:
.dst files used for SplitsTree analysis

script used:
adegenet_Ana_version.R Provided by Dr. Levi Yant


Allele frequency for with and without outliers (language: unix):

Input files 9:
With Outliers: 
Input VCF File: my_filtered_output.vcf : the VCF file containing variant calls
Input Populations File: with_individuals_population_ids.txt (a text file mapping individuals to their populations).


Without Outliers:
Input VCF File: my_filtered_output_no_outliers.vcf : the VCF file after outliers have been removed).
Input Populations File: without_individuals_population_ids_updated.txt : updated population file reflecting the removal of outliers


Output files 9:

Allele Frequency Output (With Outliers): freq_with
Allele Frequency Output (Without Outliers): freq_without


Script used:
poly_freq.c
other script as well (gcc)
the script for pops files: to make tab delianated txt file (with and without)individuals_population_ids.txt
 

info: 
outlined the process for calculating allele frequencies for VCF datasets with and without outliers using a custom C program poly_freq.c. This program requires the installation of gcc and uses command-line parameters to operate. 


Allele frequency histogram (language: R)

Input files 10:
freq_with.txt: This should be a text file containing allele frequency data for the population including outliers. It must include columns for CHROM (chromosome), POS (position), and AF (allele frequency).
freq_without.txt: Similar to freq_with.txt, this file contains allele frequency data for the population excluding outliers, with the same columns for chromosome, position, and allele frequency.



Output files 10:

Histogram_of_Hybrid_Simulation.pdf: This is the output file generated by the script. It is a PDF document containing the histogram of mean allele frequencies across the combined datasets. This file is created and saved in the current working directory, unless specified otherwise. You can adjust the file name and path as needed in the pdf() function call.


Script used:



References
All tools and datasets used in this project are referenced below:
GATK: McKenna A, et al. 2010. The Genome Analysis Toolkit: A MapReduce framework for analyzing next-generation DNA sequencing data. Genome Research 20:1297-1303. GATK
VcfR: Knaus BJ, Gr√ºnwald NJ. 2017. VcfR: an R package to manipulate and visualize VCF format data. Molecular Ecology Resources 17:44-53. vcfR on CRAN
poly_freq GitHub Repository

